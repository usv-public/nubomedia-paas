<!--
  ~ Copyright (c) 2015-2016 Fraunhofer FOKUS
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<!-- Breadcrum container -->
<section class="breadcrumb-container clearfix">
  <!-- Breadcrum -->
  <ul class="c-breadcrumb">

  <li class="c-breadcrumb__item">
    <a href="/">Overview</a>
  </li>

  <li class="c-breadcrumb__item">
    <a href="#/applications">Applications</a>
  </li>

  <li class="c-breadcrumb__item is-active">
  <a href="">{{application.name}}</a>
  </li>

  </ul><!-- Breadcrum -->
</section><!-- /Breadcrum container -->




<section class="section-nav-tabs">

  <alert
    ng-repeat="alert in alerts"
    type="alert.type"
    close="closeAlert($index)">
    <div ng-bind-html="alert.msg"></div>
  </alert>

  <tabset>

    <!-- Resources -->
    <tab heading="Resources" >
      <div ng-include src="'./templates/resources.html'"></div>
    </tab><!--/Resources -->




    <!-- Deploy -->
    <tab heading="Deploy">
      <div ng-include src="'./templates/deploy.html'"></div>
    </tab><!--/Deploy -->




    <!-- Metrics -->
    <tab heading="Metrics">

    </tab><!--/Metrics -->




    <!-- Activity -->
    <tab heading="Activity">
      <div ng-include src="'./templates/activity.html'"></div>
    </tab><!--/Activity -->




    <!-- Settings -->
    <tab heading="Settings">

      <!-- Form app settings-->
      <form class="form form-horizontal form-app-settings">

        <!-- Form section -->
        <section class="form__section">

          <h3 class="form__section-title">General</h3>

          <!-- Application name -->
          <div class="form-group input">
            <label for="app-name" class="col-md-4 control-label input__label">
              Application name
            </label>

            <div class="col-md-8">
              <input type="text" class="form-control input__field" id="app-name" ng-model="application.name" readonly>
            </div>
          </div><!-- /Application name -->

          <!-- Application kms -->
          <div class="form-group input">
            <label for="app-kms" class="col-md-4 control-label input__label">
              KMS Build Packs
              <span class="input__subtitle">
                Buildpacks are scripts that are run when KMS is displayed. They are used to install dependencies for KMS and configure the KMS servers environment.
                <span>Example</span>
              </span>
            </label>

            <div class="col-md-8">
              <input type="text" class="form-control input__field" id="app-kms">
            </div>
          </div><!-- /Application kms -->

        </section><!-- /Form section -->





        <!-- Form section -->
        <section class="form__section">

          <h3 class="form__section-title">Variables</h3>

          <!-- Environment variables -->
          <div class="form-group input">

            <label for="app-kms" class="col-md-4 control-label input__label">
              Environment variables
              <span class="input__subtitle">
                ENV variables change the way your app behaves. They are basicaly Linux ENV vars and in java they cand be used in code like this:
                <strong>process.env ["MYSQL_PASS"]</strong>
              </span>
            </label>

            <div class="col-md-8">
              <div class="row">

                <div class="col-md-12 col-lg-4">
                  <label class="form__group-label">Variables</label>
                </div><!-- /col -->

                <div class="col-md-12 col-lg-8">
                  <label class="form__group-label">Value</label>
                </div><!-- /col -->

                <!-- Section to add dynamic fields for env variables -->
                <section class="js-section-add-env">
                  <!-- ENV variable section -->
                  <div class="col-md-12 col-lg-4">
                    <div class="input">
                      <input type="text" class="form-control input__field" placeholder="variable">
                    </div>
                  </div><!-- /col -->

                  <div class="col-md-12 col-lg-8">
                    <div class="input">
                      <input type="text" class="form-control input__field" placeholder="value">
                    </div>
                  </div><!-- ENV variable section -->
                </section><!-- /Section to add dynamic fields for env variables -->

              </div><!-- /row -->
            </div><!-- /col -->

          </div><!-- /Application kms -->

          <!-- Custom TURN Server -->
          <div class="form-group input">

            <label class="col-md-4 control-label input__label">
              Custo TURN Server
            </label>

            <div class="col-md-8">
              <div class="row">

                <div class="col-md-12 col-lg-4">
                  <input type="text" class="form-control input__field" placeholder="URL">
                </div><!-- /col -->

                <div class="col-md-12 col-lg-4">
                  <input type="text" class="form-control input__field" placeholder="Username">
                </div><!-- /col -->

                <div class="col-md-12 col-lg-4">
                  <input type="text" class="form-control input__field" placeholder="Password">
                </div><!-- /col -->

              </div><!-- /row -->
            </div><!-- /col -->

          </div><!-- /Custom TURN Server -->

          <!-- Custom STUN Server -->
          <div class="form-group input">

            <label class="col-md-4 control-label input__label">
              Custo STUN Server
            </label>

            <div class="col-md-8">
              <div class="row">

                <div class="col-md-12 col-lg-4">
                  <input type="text" class="form-control input__field" placeholder="URL">
                </div><!-- /col -->

                <div class="col-md-12 col-lg-4">
                  <input type="text" class="form-control input__field" placeholder="Username">
                </div><!-- /col -->

                <div class="col-md-12 col-lg-4">
                  <input type="text" class="form-control input__field" placeholder="Password">
                </div><!-- /col -->

              </div><!-- /row -->
            </div><!-- /col -->

          </div><!-- /Custom STUN Server -->

        </section><!-- /Form section -->





        <!-- Form section -->
        <section class="form__section">

          <h3 class="form__section-title">Security</h3>

          <!-- Public domain name -->
          <div class="form-group input">

            <label for="app-public-url" class="col-md-4 control-label input__label">
              Public domain name
            </label>

            <div class="col-md-8">
              <input type="text" class="form-control input__field" id="app-public-url" placeholder="URL">
            </div>

          </div><!-- /Public domain name -->

          <!-- Upload to marketplace -->
          <div class="form-group input">

            <label for="app-kms" class="col-md-4 control-label input__label">
              Upload to marketplace
              <span class="input__subtitle">
                Your app will be available in our store.
              </span>
            </label>

            <div class="col-md-8">
              <span class="btn btn--white">Add now</span>
            </div>

          </div><!-- /Upload to marketplace -->

          <!-- Delete the application -->
          <div class="form-group input">

            <label for="app-kms" class="col-md-4 control-label input__label">
              Delete the application
              <span class="input__subtitle">
                Use this carefull, the process is ireversible
              </span>
            </label>

            <div class="col-md-8">
              <span class="btn btn-danger">Delete</span>
            </div>

          </div><!-- /Delete the application -->

        </section><!-- /Form section -->

      </form>
    </tab><!--/Settings -->










    <tab heading="Info">

      <h3 class="section section__title">
        <a href="#" data-toggle="modal" data-target="#jsonInfo">Show JSON</a>
      </h3>

      <section class="simple-card">
        <dl class="dl-horizontal">
          <spam ng-if="application.route">
            <dt>route</dt>
            <dd><a href="https://{{application.route}}" target="_blank">{{application.route}}</a>
            </dd>
          </spam>
          <spam ng-repeat="(k,v) in application" ng-if="k!='route'">
            <dt>{{k}}</dt>
            <dd>{{v}}</dd>
          </spam>
        </dl>
      </section>
    </tab>

    <tab heading="Logs">

      <div ng-include src="'./templates/logs.html'"></div>
      <section ng-show="application" class="log-buttons">

        <div class="input-group log-button">
          <span class="input-group-addon">N. of rows</span>
          <input
            type="number"
            class="form-control log-input"
            aria-label="Text input with dropdown button"
            ng-model="input.numberRows">
        </div>

        <!-- Dropdown -->
        <div class="list-btn dropdown c-dropdown dropdown-app-actions log-button">

          <button
            class="btn dropdown-toggle c-dropdown__toggle"
            type="button"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="true"
            id="get_log_app" >
            Actions
          </button>

          <ul class="dropdown-menu c-dropdown__menu">
            <li ng-repeat="pod in application.podList" class="c-dropdown__item">
              <span ng-click="loadAppLog(pod)">{{pod}}</span>
            </li>
          </ul>

        </div><!-- /Dropdown -->

        <button
          id="get_log"
          class="btn btn--white log-button"
          title="Loads the build logs"
          ng-click="loadLog()">
          Build Log
        </button>
      </section>

      <section ng-show="log">
        <pre id="log" ng-bind-html="log"></pre>
      </section>

    </tab>

    <tab heading="Monitoring" ng-click="showPlot()">
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">Autoscaling</div>
                    <div class="panel-body">

                        <div class="col-lg-6">
                            <h4>Number of KMS instances</h4>
                            <div id="numberFlot"></div>
                        </div>


                        <div class="col-lg-6">
                            <h4>Total Capacity used</h4>

                            <div id="capacityFlot"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </tab>
    <tab heading="Media Servers">
                <br>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">Media servers monitoring</div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <p>In order to access the Kurento Media Servers you can ssh using their IP addresses and username root with password nub0m3d1@</p>
                                        <div class="form-group">
                                            <label>Media Server Public IPs: </label>
                                            <select ng-model="myMediaServer" ng-options="mediaServer.floatingIPs for mediaServer in mediaServers" ng-change="updateGraphMediaServer(myMediaServer.hostname)"></select>
                                        </div>
                                        <div class="form-group">
                                            <label>Media Server Hostname: </label>
                                            <div id="hostname">{{myMediaServer.hostname}}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div id="chart_div" style="width: 100%; height: 450px;"></div>
                                        <p class="buttons-media-server">
                                            <button type="button" ng-click="drawColumnMediaServer('memory')" class="btn btn-default btn-xs">Memory</button>
                                            <button type="button" ng-click="drawColumnMediaServer('elements')" class="btn btn-default btn-xs">Elements</button>
                                            <button type="button" ng-click="drawColumnMediaServer('pipelines')" class="btn btn-default btn-xs">Pipelines</button>
                                            <button type="button" ng-click="drawColumnMediaServer('none')" class="btn btn-danger btn-xs">Reset</button>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </tab>

  </tabset>
</section>

<!-- /.wrapper -->


<div class="modal" id="jsonInfo" tabindex="" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">JSON of Topology: {{application.name}}</h4>
            </div>
            <div class="modal-body">
                <pre id="json">{{applicationJSON}}</pre>
            </div>
            <div class="modal-footer">
                <button type="button" id="closeModal" class="btn btn-default"
                        data-dismiss="modal">Close
                </button>
            </div>
        </div>
    </div>
</div>
